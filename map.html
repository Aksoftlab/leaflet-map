<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Offline Field Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="leaflet.css" />
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    .recenter-button {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: white;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 1px 5px rgba(0,0,0,0.65);
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="recenter-button" onclick="recenterMap()">üéØ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</div>

  <script src="leaflet.js"></script>
  <script>
    const map = L.map('map', {
      zoomControl: true
    }).setView([28.0, 78.0], 13);

    const tiles = L.tileLayer('./tiles/{z}/{x}/{y}.png', {
      minZoom: 10,
      maxZoom: 18,
      attribution: 'Local Tiles'
    }).addTo(map);

    const customerData = [
      { lat: 28.001, lon: 78.001, name: 'Customer A', status: 'done' },
      { lat: 28.002, lon: 78.002, name: 'Customer B', status: 'pending' },
    ];

    customerData.forEach(cust => {
      const iconUrl = cust.status === 'done' ? 'green-marker.png' : 'red-marker.png';
      const icon = L.icon({
        iconUrl: iconUrl,
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
      });

      L.marker([cust.lat, cust.lon], { icon }).addTo(map)
        .bindPopup(cust.name);
    });

    let userMarker = null;
    let shouldRecenter = true;

    function updateUserLocation(lat, lon) {
      if (!userMarker) {
        userMarker = L.marker([lat, lon], { color: 'blue' }).addTo(map);
        if (shouldRecenter) {
          map.setView([lat, lon], 15);
          shouldRecenter = false;
        }
      } else {
        userMarker.setLatLng([lat, lon]);
      }
    }

    function recenterMap() {
      if (userMarker) {
        map.setView(userMarker.getLatLng(), 15);
      }
    }

    // JS ‡§á‡§Ç‡§ü‡§∞‡§´‡•á‡§∏ ‡§∏‡•á Android WebView ‡§ï‡•ã ‡§ï‡•â‡§≤‡§¨‡•à‡§ï
    function locationupdate(lat, lon) {
      updateUserLocation(lat, lon);
    }

    map.on('click', function(e) {
      const lat = e.latlng.lat.toFixed(6);
      const lon = e.latlng.lng.toFixed(6);
      if (window.AndroidInterface && AndroidInterface.fillCoordinates) {
        AndroidInterface.fillCoordinates(lat, lon);
      } else {
        alert(`Lat: ${lat}, Lon: ${lon}`);
      }
    });

  </script>
</body>
</html>
